# BRS-EMU: BrightScript 2D API Emulator

An emulator for the Roku BrightScript language that runs on Chromium based browsers and Electron applications.

[![NPM Version](https://badge.fury.io/js/brs-emu.svg?style=flat)](https://npmjs.org/package/brs-emu)

## The Library

This library extends [**brs**](https://github.com/sjbarag/brs), a _command line interpreter_ for **BrightScript** language, by implementing the **Draw 2D API** components (`roScreen`, `roCompositor`, `roRegion`, etc.) and several other **BrightScript** components allowing a full channel execution over an **HTML5 Canvas**, including emulation of the Roku remote control. 

**Note:** Although **brs-emu** runs channels with user interface, it has no intention of emulating the full **Roku OS** user interface, see [Current Limitations](docs/limitations.md) page for full details on what is out of scope.

<p align="center">
<img alt="Emulator Web and Desktop" src="docs/images/screenshots.png?raw=true"/>
</p>

## Technology and Compatibility

This emulator is bundled as a **[Webpack](https://webpack.js.org/)** Javascript library that runs as a **[Web Worker](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers)**, and it uses features like [SharedArrayBuffer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer) and [OffScreenCanvas](https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas), that are _bleeding edge_ in the browser engines implementation, because of that, at this moment, it can only be executed in [Chromium](https://www.chromium.org/Home) based browsers, like [Chrome](https://www.google.com/chrome/), [Brave](https://brave.com/download/), [Opera](https://www.opera.com/), [Edge](https://www.microsoft.com/en-us/edge) or embedded on an [Electron](https://electronjs.org/) application. 

The **BrightScript 2D API Emulator** is a full client-side library, nothing is sent or processed in the server side. In addition to the included sample **web application**, every [release](https://github.com/lvcabral/brs-emu/releases) also includes a multi-platform **desktop application** (Windows, Linux & macOS) that uses the same library generated by this project.

The desktop app, introduces several aditional features, such as the **full screen** support, **ECP** (External Control Protocol) and **Remote Console** servers to allow integration with 3rd party development tools like the [VSCode BrightScript Extension](https://marketplace.visualstudio.com/items?itemName=celsoaf.brightscript). The Electron app source code and documentation is available in another repository, located at https://github.com/lvcabral/brs-emu-app.

## Usage

If you just want to try the emulator, not installing or downloading anything, then simply try the demo website at: https://lvcabral.com/brs

### Installation
The **brs-emu** project is published as a `node` package, so use `npm`:

```shell
$ npm install brs-emu
```

or `yarn` if that's your preference:

```shell
$ yarn add brs-emu
```

### Integrating to your Code

The full documentation for integrating the library to an application is not available yet, for now, please take a look at the file `app/index.js` for reference on how to use it. Below a simple code using the library to display its version on the console. An API will soon be available to facilitate the usage of the web worker library.

```javascript
// Initialize Worker
let brsWorker = new Worker("node_modules/brs-emu/app/lib/brsEmu.js");
brsWorker.addEventListener("message", receiveMessage);
brsWorker.postMessage("getVersion");
// Web Worker Callback
function receiveMessage(event) {
if (event.data.slice(0, 8) === "version:") {
        console.log(event.data.slice(8));
    }
}
```

### Web Application

This repository provides a sample web appplication for testing the emulator, located under the `app` folder. The application cannot be run as pure HTML page, because some functionalities used by the emulator have security restrictions on the browser engine, so you will need a web server to run it. For that you can use `Apache`, `IIS` or any simpler web server, but please note that starting from **Chrome** version **92**, the emulator web app will require to be hosted with [COOP and COEP custom headers](https://developer.chrome.com/blog/enabling-shared-array-buffer/) to allow isolation and enable usage of **ShareArrayBuffer**. More information visit: https://developer.chrome.com/blog/enabling-shared-array-buffer/

The repository provides a **Python 3** script to create a simplified web server to help testing the web application on development environment, in order to start the web server, on a terminal, go to the `app/` folder located under repository root, and execute:
```shell
    python ./web-server.py
```
By default the server will use the port 8080, if you prefer another port just change it inside the python script (**web-server.py**).
To run the web application navigate with your Chromium based browser to `http://localhost:8080/index.html`.


### Desktop Application

You can also run the emulator as a desktop application, download and install the specific OS package from the [latest release](https://github.com/lvcabral/brs-emu/releases). For the app source and documentation check the [app repository](https://github.com/lvcabral/brs-emu-app).

### Note for BrightScript Developers

You can see the debug messages from `print` statements in your code using the _browser console_, just make sure you open the _Developer Tools (Ctrl+Shift+i)_ before loading your channel package or brs file. Exceptions from the emulator will be shown there too. If your code does show an error in some scenario not listed on the [limitations documentation](docs/limitations.md), feel free to [open an issue](https://github.com/lvcabral/brs-emu/issues).

### Games and Demos

You can try the emulator by running one of the demonstration channels included in the repository, these are pre-configured as _clickable icons_ on `index.html`. In addition to those, you can load your own code, either as a single **.brs** file or a channel **.zip package**. Below there is a list of tested games that are publicly available with source code, download the `zip` files and have fun!

*   [Prince of Persia for Roku](https://github.com/lvcabral/Prince-of-Persia-Roku) port by Marcelo Lv Cabral - Download [zip file](https://github.com/lvcabral/Prince-of-Persia-Roku/releases/download/v0.18.3778/Prince-of-Persia-Roku-018.zip)
*   [Lode Runner for Roku](https://github.com/lvcabral/Lode-Runner-Roku) remake by Marcelo Lv Cabral - Download [zip file](https://github.com/lvcabral/Lode-Runner-Roku/releases/download/v0.18.707/Lode-Runner-Roku-018.zip)
*   [Retaliate](https://github.com/lvcabral/retaliate-roku) game by Romans I XVI - Download [zip file](https://github.com/lvcabral/retaliate-roku/releases/download/v1.7.0-emu/retaliate-brs-emu.zip)

## Contributing

There are many ways in which you can participate in the project, read documents below to know the details:

* [How to contribute](docs/contributing.md)
* [How to build from source](docs/build-from-source.md)

## Author Links

- My website is [https://lvcabral.com](https://lvcabral.com)
- My twitter is [@lvcabral](https://twitter.com/lvcabral)
- My podcast is [PODebug Podcast](http://podebug.com)
- Check my other [GitHub repositories ](https://github.com/lvcabral)

## License

Copyright Â© Marcelo Lv Cabral. All rights reserved.

Licensed under the [MIT](LICENSE) license.
